# PH1-03: 課題提出APIを実装する

## 1. メタ情報
- **タスクID**: PH1-03
- **タイトル**: 課題提出エンドポイントの追加
- **フェーズ**: Phase1
- **カテゴリ**: Backend
- **担当**: _(TBD)_
- **ステータス**: Planned
- **関連Issue/PR**: 禁則サービス(PH1-02)

## 2. 背景・目的
- ユーザーが課題を解いて送信し、禁則判定結果を受け取るためのAPIが未実装。
- MVP完了の必須要素として提出エンドポイントを提供する。

## 3. ゴールと非ゴール
- **ゴール**
  - POST `/api/tasks/{task_id}/submissions` を実装し、評価結果（禁則リスト等）を返却。
  - 入力/出力のPydanticスキーマを定義。
- **非ゴール**
  - 結果保存や履歴管理（Phase2予定）。

## 4. スコープ詳細
- **対象コード**: `backend/routes/tasks.py` もしくは新規 `routes/submissions.py`, サービス層。
- **参照**: PH1-01/02。

## 5. 実施ステップ
1. リクエストDTO（ユーザー解答データ）とレスポンスDTOを定義。
2. ルーターにエンドポイントを追加し、TaskService + 禁則サービスを呼び出す。
3. エラーハンドリング（課題未存在、入力不正）を整備。
4. pytestでAPIテストを追加（TestClient利用）。

## 6. 成果物
- FastAPIルート実装。
- pytestテスト。

## 7. 依存・ブロッカー
- **前提**: PH1-02の禁則サービスが利用可能。
- **考慮事項**: 認証/ユーザー識別をどう扱うか（MVPでは匿名想定）。

## 8. リスクと対策
| リスク | 影響 | 対策 |
| --- | --- | --- |
| 入力サイズが大きい | パフォーマンス低下 | MVPでは固定長4声のみ受け付ける |
| 例外処理抜け | 500エラー | FastAPIのHTTPExceptionで整える |

## 9. テスト計画
- `pytest tests/test_tasks_router.py` 等を拡張。
- 受入: 正常系で評価結果が返り、異常系で適切なステータス。

## 10. 計測
- なし。

## 11. ドキュメント
- API仕様を `docs/domain/` か `docs/project/` に追記。

## 12. タイムライン
- TBD

## 13. チェックリスト
- [ ] DTO定義
- [ ] ルート実装
- [ ] テスト追加
- [ ] ドキュメント更新
- [ ] PRマージ

---
**考慮事項**: 将来的なユーザー識別(セッション, OAuth)導入時にAPI契約をどう拡張するか留意する。
