# PH0-06: サービス層の導入とルーター整理

## 1. メタ情報
- **タスクID**: PH0-06
- **タイトル**: FastAPIにサービス層を追加し責務分離
- **フェーズ**: Phase0
- **カテゴリ**: Backend
- **担当**: _(TBD)_
- **ステータス**: Planned
- **関連Issue/PR**: -

## 2. 背景・目的
- 現在ルーターが直接リポジトリを操作しており、ビジネスロジックやデータ取得が密結合。
- 禁則判定や提出API追加時に複雑化するため、サービス層でまとめてテストしやすくする。

## 3. ゴールと非ゴール
- **ゴール**
  - `services/task_service.py`（仮）を作成し、ルーターはサービスを介してタスクを取得。
  - サービス層単体テストを追加。
- **非ゴール**
  - データベース化やDIフレームワーク導入。

## 4. スコープ詳細
- **対象コード**: `backend/routes/tasks.py`, `backend/repositories/*`, 新規 `backend/services/*`.
- **参照**: `docs/project/development-plan.md` Phase0。

## 5. 実施ステップ
1. サービスインターフェースを定義（例: `TaskService`）。
2. 既存ルーターをサービス経由に書き換え。
3. Pydanticモデルを利用した変換の必要性を検討。
4. pytestでサービス/ルーターのテストを更新。

## 6. 成果物
- 新規サービス層コード。
- pytest追加。

## 7. 依存・ブロッカー
- **前提**: なし。
- **考慮事項**: 依存注入パターン（FastAPIの `Depends` か手動DI）を選定。

## 8. リスクと対策
| リスク | 影響 | 対策 |
| --- | --- | --- |
| 層が増えて冗長 | 開発スピード低下 | サービスで行う責務を明確化し、薄いラッパーにしない |

## 9. テスト計画
- `pytest`（既存+サービス用）。
- 受入基準: ルーター経由のテストが通り、サービステストも追加。

## 10. 計測
- なし。

## 11. ドキュメント
- 必要なら `docs/development/design-guidelines.md` にサービス層方針を追記。

## 12. タイムライン
- TBD

## 13. チェックリスト
- [ ] サービスファイル追加
- [ ] ルーター修正
- [ ] テスト追加
- [ ] PR提出

---
**考慮事項**: 将来的なDB移行時にサービス層でトランザクション等を扱う想定。*** End Patch
