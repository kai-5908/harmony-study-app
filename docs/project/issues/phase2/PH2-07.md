# PH2-07: 推奨進行・コメント生成ロジックを実装する

## 1. メタ情報
- **タスクID**: PH2-07
- **タイトル**: 評価結果に推奨進行とコメントを付与
- **フェーズ**: Phase2
- **カテゴリ**: Backend / Domain
- **担当**: _(TBD)_
- **ステータス**: Planned
- **関連Issue/PR**: PH2-05

## 2. 背景・目的
- 禁則指摘だけでなく、次にとるべき和音進行や改善コメントを提示することで学習効果を高める。
- ルールベースもしくは簡易な推薦アルゴリズムを実装する。

## 3. ゴールと非ゴール
- **ゴール**
  - 入力された進行に対し、推奨コード進行リストを生成。
  - コメント（テキスト）を評価結果に同梱。
- **非ゴール**
  - 機械学習ベースの高度な推薦（将来検討）。

## 4. スコープ詳細
- **対象**: 禁則サービスの拡張、ドメインルールモジュール。
- **データ**: 和音機能（T, S, D）や一般的進行表。

## 5. 実施ステップ
1. 推奨進行のルールセットを設計（ドメイン担当と協議）。
2. 現在の進行状況から次候補を導出するアルゴリズムを実装。
3. コメントテンプレートを用意し、該当禁則に応じて生成。
4. pytestでユースケースを検証。

## 6. 成果物
- サービス実装 + テスト。

## 7. 依存・ブロッカー
- **前提**: PH2-05でUI受け皿がある。
- **考慮事項**: 楽曲調性やモードの扱いを決める必要。

## 8. リスクと対策
| リスク | 影響 | 対策 |
| --- | --- | --- |
| ルール設計の負荷が高い | 実装遅延 | MVPでは限定的な進行に絞り、段階的に拡張 |

## 9. テスト
- pytest：様々な進行に対する推奨結果を確認。

## 10. 計測
- 推奨生成にかかる時間をログする。

## 11. ドキュメント
- ルールセットを `docs/domain/` に記載。

## 12. タイムライン
- TBD

## 13. チェックリスト
- [ ] ルール設計
- [ ] 実装
- [ ] テスト
- [ ] ドキュメント
- [ ] PRマージ

---
**考慮事項**: 将来的にユーザーの解答履歴を用いた個別最適化を行う場合、データ収集と匿名化ポリシーが必要。*** End Patch
