# PH2-06: 音源再生機能を実装する

## 1. メタ情報
- **タスクID**: PH2-06
- **タイトル**: 課題譜面と同期した音源再生
- **フェーズ**: Phase2
- **カテゴリ**: Frontend / UX
- **担当**: _(TBD)_
- **ステータス**: Planned
- **関連Issue/PR**: PH1-06

## 2. 背景・目的
- ユーザーが課題や解答を聴けるようにし、耳での確認を支援する。
- WebAudioまたはMIDI再生を実装し、譜面表示と同期させる。

## 3. ゴールと非ゴール
- **ゴール**
  - 課題譜面の音源再生（テンポ一定）を提供。
  - 再生/停止/ループ等の基本操作が可能。
- **非ゴール**
  - 音質調整や高度なMIDI編集。

## 4. スコープ詳細
- **対象**: 新規 `AudioPlayer` コンポーネント、譜面コンポーネントとの連携。
- **データ**: MusicXML→MIDI変換 or 既存音源ファイル。

## 5. 実施ステップ
1. 再生方式を決定（WebAudio API, Tone.js, MIDI.js 等）。
2. MusicXML を音列データに変換するユーティリティを実装。
3. UI（ボタン、シークバー）を作成。
4. テスト/手動確認で同期ズレを確認。

## 6. 成果物
- 再生コンポーネント + テスト。

## 7. 依存・ブロッカー
- **前提**: PH1-06 で譜面が描画されている。
- **考慮事項**: ブラウザの自動再生制限、音源サイズ。

## 8. リスクと対策
| リスク | 影響 | 対策 |
| --- | --- | --- |
| ブラウザのオートプレイ制限 | 音が鳴らない | 初回にユーザー操作を要求 |
| 音源変換の精度 | 誤った音が鳴る | 既存ライブラリ(Tone.js + @tonejs/midi)の活用 |

## 9. テスト
- ユニットテスト（ロジック部分）、手動で聴感確認。

## 10. 計測
- 再生開始までのレイテンシを測定しておく。

## 11. ドキュメント
- `development-guidelines` に利用ライブラリと制限事項を追記。

## 12. タイムライン
- TBD

## 13. チェックリスト
- [ ] 再生方式決定
- [ ] 実装
- [ ] テスト/確認
- [ ] PRマージ

---
**考慮事項**: 将来的なMIDIキーボード入力との連携を考慮し、内部フォーマットを統一する。*** End Patch
