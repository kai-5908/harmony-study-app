# 開発進行計画

本ドキュメントは、和声学習アプリの継続開発にあたり「どこから手を付け、どの順序で完成度を高めていくか」を共有するための指針をまとめたものです。既存の `docs/project/project-charter.md`、`docs/development/development-process.md` と併せて参照してください。

## 1. 全体方針

- **現行コードベースを基盤として強化**する。FastAPI＋React の二層構成を活かし、段階的に機能と品質を底上げする。
- **「課題提示 → 解答入力 → 禁則評価」というMVPループの実装完了**を最優先に、五線譜表示や鍵盤UIといったUX改善は並行して計画する。
- **テスト駆動と自動化を徹底**し、既存テスト資産（API, フロント）を拡充しながら回帰抑制を図る。
- **アーキテクチャ判断はADRで記録**し、設計変更時には理由と代替案を残す。

## 2. フェーズ別ロードマップ

### フェーズ0: 足場固め（1〜2スプリント）
- フロント依存関係をWSL2上で再構築し `npm run build` / `npm run test` を安定実行。
- `HarmonyTaskListHeader` の未接続プロップ修正、`BrowserRouter` への移行など、既知のバグ／未完成部を解消。
- バックエンドのJSONリポジトリをサービス層経由で利用するよう整理し、開発用データセットを整備。
- 開発環境手順（バックエンド起動、フロント起動）を `README.md` 補足 or 個別ドキュメントへ追記。

### フェーズ1: MVP完成（3〜4スプリント）
- **課題評価ロジックの実装**  
  - 禁則・推奨ルールをドメインサービスとして実装し、テストで網羅。  
  - 課題提出API（POST `/api/tasks/{task_id}/submissions` など）を追加し、評価結果を返却。
- **解答入力UIの提供**  
  - 五線譜表示コンポーネントの導入（外部ライブラリ検討: VexFlow, OpenSheetMusicDisplay 等）。  
  - ピアノ鍵盤／音名入力UIの試作とユーザビリティ検証。
- **エンドツーエンドテスト基盤の確立**  
  - フロントは Playwright/Vitest + MSW、バックエンドは pytest でAPIフローを自動テスト。
- **最低限のログ・エラーハンドリング** を整備し、失敗時に原因が追えるようにする。

### フェーズ2: UX向上と拡張（継続）
- 課題フィルタリング／ソート（難易度、タグ、進捗）を実装し `HarmonyTaskListHeader` を活かす。
- 学習履歴・進捗ステータス管理（`TaskStatus`）をバックエンドへ実装し、ユーザー毎に保存。
- 評価結果の可視化（禁則一覧、改善提案、推奨進行）と音声再生・MIDI対応を順次追加。
- デプロイ戦略（AWS/GCP比較）とCI/CDパイプライン拡充を実施。

## 3. バックログ管理の初期分類

- **緊急修正**: 既知のビルドエラー、API契約不整合、未使用ファイル（`*.ts.new` 等）の整理。
- **機能実装**: 評価ロジック、課題提出API、譜面表示、鍵盤UI、課題フィルタリング。
- **品質向上**: 型定義厳格化、例外設計の共通化、BDD/Integrationテストの追加。
- **開発支援**: サンプルデータ拡充、自動フォーマット／Lint設定のCI化、環境構築スクリプト。
- **UX改善**: レスポンシブ対応、アクセシビリティ、音源再生機能、ガイダンスコンテンツ。

Backlog アイテムは GitHub Projects / Issues で管理し、`priority` ラベルと `phase` ラベル（phase0〜2）を付与する運用を推奨。

## 4. 役割とワークフロー

- **Product Owner / 音楽ドメイン担当**: 課題セット、禁則ルールの優先順位付け、評価結果レビューを担う。
- **Tech Lead**: アーキテクチャ判断、ADR作成、コードレビュー基準の整備。
- **Backend / ML**: 禁則判定や推薦アルゴリズムの実装、データ管理、API整備。
- **Frontend / UX**: UI設計、譜面レンダリング・入力UIの実装、ユーザー調査フィードバック反映。
- **QA / DX**: テスト戦略、CI/CD監視、ドキュメント整備、開発体験改善。

スクラム or 看板を採用し、1〜2週間単位のスプリントで計画 → 実装 → レビュー → レトロスペクティブを実施する。

## 5. 技術指針

- **型安全性重視**: FastAPI + Pydantic, TypeScript + strict オプションを維持。API スキーマは OpenAPI から自動生成し、フロントへ型を共有する仕組みを検討する。
- **テストカバレッジ目標**: コアドメインは80%以上、UIは主要ユーザーフローをPlaywright/E2Eでカバー。
- **データ保存方針**: 当面はJSONだが、評価ロジックの高度化やユーザー管理に備えDB移行（PostgreSQL等）のADRを早期に検討。
- **観測性**: ローカル段階から構造化ログと基本メトリクス（処理時間、判定結果分布）を記録する土台を設ける。

## 6. リスクと対策

| リスク | 対策 |
| --- | --- |
| 禁則ルールの複雑化による開発遅延 | ルールを優先度順に分割し、スプリント毎に増やす。音楽専門家レビューを定例化。 |
| フロントの譜面表示ライブラリ選定難航 | PoCブランチを用意し、主要候補を短期間で比較。評価基準（表示品質、ライセンス、入力支援可否）を明文化。 |
| JSON 永続化の限界 | 早期にリポジトリ抽象のユニットテストを追加し、DB実装への切り替えを容易にする。 |
| WSL/Windows間の環境差異 | `docs/development/development-guidelines.md` にWSL構築手順と注意事項を追記し、`make` 代替の PowerShell スクリプトも整備。 |

## 7. 直近アクション（2025-09 時点）

1. WSL2 環境で `npm ci` → `npm run build` を通し、型エラー修正 (`HarmonyTaskListHeader`, `BrowserRouter` 化)。
2. バックエンドで課題提出APIのエンドポイント設計をADR化し、PoCを実装。
3. 譜面描画ライブラリの比較表を作成し、UI実装スプリントへ備える。
4. Backlog を GitHub Projects に初期投入し、フェーズ0〜2へ分類。

必要に応じて本計画を更新し、主要な意思決定はADRとして履歴を残してください。

